# Video Upscaler 开发计划

## 阶段一：MVP 核心功能（2-3周）

**目标**：能跑通一个视频的超分流程

| 任务 | 说明 | 优先级 |
|------|------|--------|
| 1.1 环境搭建 | FFmpeg + PyTorch + Real-ESRGAN 集成 | P0 |
| 1.2 基础 GUI | 拖放导入 + 队列显示 + 基础控件 | P0 |
| 1.3 视频解帧 | FFmpeg 调用，提取帧序列 | P0 |
| 1.4 超分处理 | Real-ESRGAN tile 分块推理 | P0 |
| 1.5 视频编码 | FFmpeg NVENC 编码输出 | P0 |
| 1.6 进度显示 | 实时进度条 + 状态更新 | P1 |

**验收标准**：
- 480p视频 → 1080p成功输出
- 显存占用 < 4GB
- 无内存泄漏

---

## 阶段二：完整功能（2周）

**目标**：三档预设 + 批量队列 + 预览

| 任务 | 说明 | 优先级 |
|------|------|--------|
| 2.1 三档预设 | 流畅/标准/高清三档参数 | P0 |
| 2.2 任务队列 | 暂停/继续/取消 + 状态持久化 | P0 |
| 2.3 批量处理 | 多文件队列，串行执行 | P0 |
| 2.4 前后预览 | 原图/超分对比（抽帧预览） | P1 |
| 2.5 日志输出 | 实时日志 + 错误提示 | P1 |

**验收标准**：
- 批量处理5个视频无卡死
- 可随时暂停/继续
- 错误视频跳过，不中断队列

---

## 阶段三：帧率修复（1-2周）

**目标**：集成 RIFE 补帧

| 任务 | 说明 | 优先级 |
|------|------|--------|
| 3.1 RIFE 集成 | 轻量版模型集成 | P0 |
| 3.2 顺序优化 | 先超分后补帧流程 | P0 |
| 3.3 显存优化 | 超分和补帧分GPU执行 | P1 |
| 3.4 开关控制 | 用户可选是否补帧 | P1 |

**验收标准**：
- 24fps → 60fps 流畅无撕裂
- 显存占用 < 5.5GB

---

## 阶段四：优化与打包（1周）

**目标**：可发布的 Windows 程序

| 任务 | 说明 | 优先级 |
|------|------|--------|
| 4.1 模型下载器 | 首次启动自动下载模型 | P0 |
| 4.2 安装程序 | Inno Setup 安装包 | P0 |
| 4.3 性能优化 | 多线程优化，CPU利用率 | P1 |
| 4.4 错误处理 | 健壮性改进，edge case | P1 |
| 4.5 文档完善 | 使用说明 + FAQ | P2 |

---

## 开发优先级

```
P0 (必须有): 核心流程跑通，能出结果
P1 (应该有): 用户体验，基本功能完整  
P2 (可以有): 锦上添花，后期迭代
```

---

## 技术选型确认

| 组件 | 选择 | 状态 |
|------|------|------|
| 超分引擎 | Real-ESRGAN + ONNX Runtime | ✅ 已定 |
| 补帧引擎 | RIFE-lite | ✅ 已定 |
| GUI 框架 | PyQt6 | ✅ 已定 |
| 视频处理 | FFmpeg-python | ✅ 已定 |
| CUDA 版本 | 11.8/12.1 | 待定 |

---

## 里程碑

- **M1 (1周末)**: 能解帧+超分单张图
- **M2 (2周末)**: 完整视频处理 pipeline
- **M3 (4周末)**: 完整 GUI + 批量功能
- **M4 (6周末)**: 帧率修复 + 打包发布

---

## 当前进度

- [x] 项目结构搭建
- [x] README + 依赖
- [x] GUI 框架（主窗口、队列、预览位）
- [x] FFmpeg 环境检测 (core/env_checker.py)
- [x] 模型下载脚本 (scripts/download_models.py)
- [x] 核心处理引擎 (core/video_engine.py, core/upscaler.py)
- [x] 任务队列处理逻辑 (gui/task_queue.py)
- [x] 进度显示与信号连接

**下一步**：测试完整视频处理流程
